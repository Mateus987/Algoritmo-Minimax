<!DOCTYPE html>
<html>
<head>
  <title>Minimax - Jogo da Velha</title>
  <style>
    h1 {
      color: whitesmoke;
    }

    body {
      background-color: black;
    }

    #board {
      width: 160px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
      background-color: #f2f2f2;
      padding: 10px;
    }

    .cell {
      width: 50px;
      height: 50px;
      border: 1px solid #000;
      text-align: center;
      font-size: 32px;
      line-height: 50px;
      cursor: pointer;
    }

    .cell:nth-child(3n+1) {
      border-left: none;
    }

    .cell:nth-child(n+7) {
      border-bottom: none;
    }
  </style>
  <script>
    // Definição dos jogadores
    const JOGADOR_X = 'X';
    const JOGADOR_O = 'O';

    // Definição do tabuleiro do jogo
    let tabuleiro = ['', '', '', '', '', '', '', '', ''];

    // Função para calcular a pontuação de um estado do jogo
    function pontuacaoDoEstado(estado) {
      // Verificar se houve um vencedor
      const combinacoesVencedoras = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // linhas
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // colunas
        [0, 4, 8], [2, 4, 6] // diagonais
      ];

      for (const combinacao of combinacoesVencedoras) {
        const [a, b, c] = combinacao;
        if (estado[a] !== '' && estado[a] === estado[b] && estado[a] === estado[c]) {
          return estado[a] === JOGADOR_X ? 1 : -1;
        }
      }

      // Verificar se é empate
      if (!estado.includes('')) {
        return 0;
      }

      // O jogo ainda está em andamento
      return null;
    }

    // Função para verificar se o jogo terminou
    function jogoTerminou(estado) {
      return pontuacaoDoEstado(estado) !== null || !estado.includes('');
    }

    // Função para realizar a busca em árvore usando o algoritmo Minimax com poda alfa-beta
    function minimaxAlphaBeta(estado, profundidade, alpha, beta, jogadorMaximizador) {
      if (jogoTerminou(estado) || profundidade === 0) {
        return pontuacaoDoEstado(estado);
      }

      if (jogadorMaximizador) {
        let melhorPontuacao = -Infinity;

        for (let i = 0; i < estado.length; i++) {
          if (estado[i] === '') {
            estado[i] = JOGADOR_X;
            let pontuacao = minimaxAlphaBeta(estado, profundidade - 1, alpha, beta, false);
            estado[i] = '';
            melhorPontuacao = Math.max(melhorPontuacao, pontuacao);
            alpha = Math.max(alpha, pontuacao);
            if (beta <= alpha) {
              break; // Poda beta
            }
          }
        }

        return melhorPontuacao;
      } else {
        let melhorPontuacao = Infinity;

        for (let i = 0; i < estado.length; i++) {
          if (estado[i] === '') {
            estado[i] = JOGADOR_O;
            let pontuacao = minimaxAlphaBeta(estado, profundidade - 1, alpha, beta, true);
            estado[i] = '';
            melhorPontuacao = Math.min(melhorPontuacao, pontuacao);
            beta = Math.min(beta, pontuacao);
            if (beta <= alpha) {
              break; // Poda alfa
            }
          }
        }

        return melhorPontuacao;
      }
    }

    // Função para encontrar o melhor movimento usando o algoritmo Minimax com poda alfa-beta
    function encontrarMelhorMovimento(jogador) {
      let melhorPontuacao = jogador === JOGADOR_X ? -Infinity : Infinity;
      let melhorMovimento;

      for (let i = 0; i < tabuleiro.length; i++) {
        if (tabuleiro[i] === '') {
          tabuleiro[i] = jogador;
          let pontuacao = minimaxAlphaBeta(tabuleiro, 5, -Infinity, Infinity, jogador === JOGADOR_X ? false : true);
          tabuleiro[i] = '';
          if ((jogador === JOGADOR_X && pontuacao > melhorPontuacao) || (jogador === JOGADOR_O && pontuacao < melhorPontuacao)) {
            melhorPontuacao = pontuacao;
            melhorMovimento = i;
          }
        }
      }

      return melhorMovimento;
    }

    // Função para fazer um movimento no tabuleiro
    function fazerMovimento(jogador, indice) {
      if (tabuleiro[indice] === '') {
        tabuleiro[indice] = jogador;
        atualizarTabuleiro();

        if (!jogoTerminou(tabuleiro)) {
          const proximoJogador = jogador === JOGADOR_X ? JOGADOR_O : JOGADOR_X;
          const melhorMovimento = encontrarMelhorMovimento(proximoJogador);
          setTimeout(function() {
            fazerMovimento(proximoJogador, melhorMovimento);
          }, 500);
        } else {
          setTimeout(function() {
            alert("Fim do jogo!");
            reiniciarJogo();
          }, 500);
        }
      }
    }

    // Função para atualizar o tabuleiro no HTML
    function atualizarTabuleiro() {
      const cells = document.getElementsByClassName('cell');
      for (let i = 0; i < tabuleiro.length; i++) {
        cells[i].textContent = tabuleiro[i];
      }
    }

    // Função para reiniciar o jogo
    function reiniciarJogo() {
      tabuleiro = ['', '', '', '', '', '', '', '', ''];
      atualizarTabuleiro();
      jogarAutomaticamente();
    }

    // Função para jogar automaticamente
    function jogarAutomaticamente() {
      const jogadorInicial = Math.random() < 0.5 ? JOGADOR_X : JOGADOR_O;
      fazerMovimento(jogadorInicial, encontrarMelhorMovimento(jogadorInicial));
    }

    // Event listener para cliques nas células do tabuleiro
    document.addEventListener('DOMContentLoaded', function() {
      const cells = document.getElementsByClassName('cell');
      for (let i = 0; i < cells.length; i++) {
        cells[i].addEventListener('click', function() {
          fazerMovimento(JOGADOR_X, i);
        });
      }
      jogarAutomaticamente();
    });
  </script>
</head>
<body>
  <h1>Jogo da Velha</h1>
  <div id="board">
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
  </div>
</body>
</html>
