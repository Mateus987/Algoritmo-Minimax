<!DOCTYPE html>
<html>
<head>
  <title>Jogo da Velha - IA x IA</title>
  <style>
    h1 {
      color: whitesmoke;
      text-align: center;
    }

    h3 {
      color: whitesmoke;
      text-align: center;
    }

    body {
      background-color: #655D5D;
    }

    #board {
      width: 160px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
      background-color: #655D5D;
      padding: 10px;
    }

    .cell {
      color: aliceblue;
      width: 50px;
      height: 50px;
      border: 3px solid white;
      text-align: center;
      font-size: 32px;
      line-height: 50px;
      cursor: pointer;
    }



    #score {
      color: white;
      text-align: center;
      margin-top: 10px;
      font-size: 24px;
    }
  </style>
</head>
<body>
  <h1>Jogo da Velha - IA x IA</h1>
  <h3>Algoritmo minimax com poda alfa-beta</h3>
  <div id="board">
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
    <div class="cell"></div>
  </div>

  <div id="score"></div>

  <script>
    // Definição dos jogadores
    const JOGADOR_X = 'X';
    const JOGADOR_O = 'O';

    // Definição do tabuleiro do jogo
    let tabuleiro = ['', '', '', '', '', '', '', '', ''];

    // Função para calcular a pontuação de um estado do jogo
    function pontuacaoDoEstado(estado) {
      // Verificar se houve um vencedor
      const combinacoesVencedoras = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // linhas
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // colunas
        [0, 4, 8], [2, 4, 6] // diagonais
      ];

      for (const combinacao of combinacoesVencedoras) {
        const [a, b, c] = combinacao;
        if (estado[a] !== '' && estado[a] === estado[b] && estado[a] === estado[c]) {
          return estado[a] === JOGADOR_X ? 1 : -1;
        }
      }

      // Verificar se é empate
      if (!estado.includes('')) {
        return 0;
      }

      // O jogo ainda está em andamento
      return null;
    }

    // Função para verificar se o jogo terminou
    function jogoTerminou(estado) {
      return pontuacaoDoEstado(estado) !== null || !estado.includes('');
    }

    // Função para realizar a busca em árvore usando o algoritmo Minimax com poda alfa-beta
    function minimaxAlphaBeta(estado, profundidade, alpha, beta, jogadorMaximizador) {
      if (jogoTerminou(estado) || profundidade === 0) {
        return pontuacaoDoEstado(estado);
      }

      if (jogadorMaximizador) {
        let melhorPontuacao = -Infinity;

        for (let i = 0; i < estado.length; i++) {
          if (estado[i] === '') {
            estado[i] = JOGADOR_X;
            let pontuacao = minimaxAlphaBeta(estado, profundidade - 1, alpha, beta, false);
            estado[i] = '';
            melhorPontuacao = Math.max(melhorPontuacao, pontuacao);
            alpha = Math.max(alpha, pontuacao);
            if (beta <= alpha) {
              break; // Poda beta
            }
          }
        }

        return melhorPontuacao;
      } else {
        let melhorPontuacao = Infinity;

        for (let i = 0; i < estado.length; i++) {
          if (estado[i] === '') {
            estado[i] = JOGADOR_O;
            let pontuacao = minimaxAlphaBeta(estado, profundidade - 1, alpha, beta, true);
            estado[i] = '';
            melhorPontuacao = Math.min(melhorPontuacao, pontuacao);
            beta = Math.min(beta, pontuacao);
            if (beta <= alpha) {
              break; // Poda alfa
            }
          }
        }

        return melhorPontuacao;
      }
    }

    // Função para encontrar o melhor movimento usando o algoritmo Minimax com poda alfa-beta
    function encontrarMelhorMovimento(jogador) {
      let melhorPontuacao = jogador === JOGADOR_X ? -Infinity : Infinity;
      let melhorMovimento;

      for (let i = 0; i < tabuleiro.length; i++) {
        if (tabuleiro[i] === '') {
          tabuleiro[i] = jogador;
          let pontuacao = minimaxAlphaBeta(tabuleiro, 5, -Infinity, Infinity, jogador === JOGADOR_X ? false : true);
          tabuleiro[i] = '';
          if ((jogador === JOGADOR_X && pontuacao > melhorPontuacao) || (jogador === JOGADOR_O && pontuacao < melhorPontuacao)) {
            melhorPontuacao = pontuacao;
            melhorMovimento = i;
          }
        }
      }

      return melhorMovimento;
    }

    // Função para fazer um movimento no tabuleiro
    function fazerMovimento(jogador, index) {
      if (!jogoTerminou(tabuleiro) && tabuleiro[index] === '') {
        tabuleiro[index] = jogador;
        atualizarTabuleiro();

        if (!jogoTerminou(tabuleiro)) {
          const proximoJogador = jogador === JOGADOR_X ? JOGADOR_O : JOGADOR_X;

          // Medir o tempo de processamento
          const startTime = performance.now();

          const melhorMovimento = encontrarMelhorMovimento(proximoJogador);

          const endTime = performance.now();
          const tempoProcessamento = endTime - startTime;
          console.log(`Tempo de processamento: ${tempoProcessamento}ms`);

          setTimeout(function() {
            fazerMovimento(proximoJogador, melhorMovimento);
          }, 500);
        }

        if (jogoTerminou(tabuleiro)) {
          const pontuacao = pontuacaoDoEstado(tabuleiro);
          exibirPontuacao(pontuacao);
        }
      }
    }


    // Função para atualizar o tabuleiro na interface
    function atualizarTabuleiro() {
      const cells = document.querySelectorAll('.cell');
      for (let i = 0; i < cells.length; i++) {
        cells[i].innerText = tabuleiro[i];
      }
    }

    // Função para exibir a pontuação na interface
    function exibirPontuacao(pontuacao) {
      const score = document.getElementById('score');
      if (pontuacao === 0) {
        score.innerText = 'Empate!';
      } else {
        score.innerText = 'Você venceu!';
      }
    }

    // Event listener para fazer um movimento quando um jogador clica em uma célula
    document.getElementById('board').addEventListener('click', function(event) {
      const index = Array.from(event.target.parentNode.children).indexOf(event.target);
      fazerMovimento(JOGADOR_O, index);
    });

    // Iniciar o jogo fazendo o primeiro movimento
    fazerMovimento(JOGADOR_X, 0);
  </script>
</body>
</html>
