<!DOCTYPE html>
<html>
<head>
  <title>Minimax - Jogador x IA</title>
  <style>
    h1 {
      color: whitesmoke;
      text-align: center;
    }

    h3 {
      color: whitesmoke;
      text-align: center;
    }

    body {
      background-color: #655D5D;
    }

    #board {
      width: 160px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
      background-color: #655D5D;
      padding: 10px;
    }

    .cell {
      color: aliceblue;
      width: 50px;
      height: 50px;
      border: 3px solid white;
      text-align: center;
      font-size: 32px;
      line-height: 50px;
      cursor: pointer;
    }

    #score {
      color: white;
      text-align: center;
      margin-top: 10px;
      font-size: 24px;
    }
  </style>
  <script>
    // Definição dos jogadores
    const JOGADOR_X = 'X';
    const JOGADOR_O = 'O';

    // Definição do tabuleiro do jogo
    let tabuleiro = ['', '', '', '', '', '', '', '', ''];

    // Pontuação inicial
    let pontuacao = {
      vitorias: 0,
      empates: 0,
      derrotas: 0
    };

    // Função para calcular a pontuação de um estado do jogo
    function pontuacaoDoEstado(estado) {
      // Verificar se houve um vencedor
      const combinacoesVencedoras = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // linhas
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // colunas
        [0, 4, 8], [2, 4, 6] // diagonais
      ];

      for (const combinacao of combinacoesVencedoras) {
        const [a, b, c] = combinacao;
        if (estado[a] !== '' && estado[a] === estado[b] && estado[a] === estado[c]) {
          return estado[a] === JOGADOR_X ? 1 : -1;
        }
      }

      // Verificar se é empate
      if (!estado.includes('')) {
        return 0;
      }

      // O jogo ainda está em andamento
      return null;
    }

    // Função para verificar se o jogo terminou
    function jogoTerminou(estado) {
      return pontuacaoDoEstado(estado) !== null || !estado.includes('');
    }

    // Função para realizar a busca em árvore usando o algoritmo Minimax com poda alfa-beta
    function minimaxAlphaBeta(estado, profundidade, alpha, beta, jogadorMaximizador) {
      if (jogoTerminou(estado) || profundidade === 0) {
        return pontuacaoDoEstado(estado);
      }

      if (jogadorMaximizador) {
        let melhorPontuacao = -Infinity;

        for (let i = 0; i < estado.length; i++) {
          if (estado[i] === '') {
            estado[i] = JOGADOR_X;
            let pontuacao = minimaxAlphaBeta(estado, profundidade - 1, alpha, beta, false);
            estado[i] = '';
            melhorPontuacao = Math.max(melhorPontuacao, pontuacao);
            alpha = Math.max(alpha, pontuacao);
            if (beta <= alpha) {
              break; // Poda beta
            }
          }
        }

        return melhorPontuacao;
      } else {
        let melhorPontuacao = Infinity;

        for (let i = 0; i < estado.length; i++) {
          if (estado[i] === '') {
            estado[i] = JOGADOR_O;
            let pontuacao = minimaxAlphaBeta(estado, profundidade - 1, alpha, beta, true);
            estado[i] = '';
            melhorPontuacao = Math.min(melhorPontuacao, pontuacao);
            beta = Math.min(beta, pontuacao);
            if (beta <= alpha) {
              break; // Poda alfa
            }
          }
        }

        return melhorPontuacao;
      }
    }


function encontrarMelhorMovimento() {
  console.time('encontrarMelhorMovimento');
  let melhorPontuacao = -Infinity;
  let melhorMovimento;

  for (let i = 0; i < tabuleiro.length; i++) {
    if (tabuleiro[i] === '') {
      tabuleiro[i] = JOGADOR_X;
      let pontuacao = minimaxAlphaBeta(tabuleiro, 5, -Infinity, Infinity, false);
      tabuleiro[i] = '';
      if (pontuacao > melhorPontuacao) {
        melhorPontuacao = pontuacao;
        melhorMovimento = i;
      }
    }
  }

  console.timeEnd('encontrarMelhorMovimento');
  return melhorMovimento;
}

// Função para fazer um movimento no tabuleiro
function makeMove(index) {
  if (!jogoTerminou(tabuleiro) && tabuleiro[index] === '') {
    tabuleiro[index] = JOGADOR_O;
    atualizarTabuleiro();

    if (!jogoTerminou(tabuleiro)) {
      console.time('encontrarMelhorMovimento');
      const melhorMovimento = encontrarMelhorMovimento();
      console.timeEnd('encontrarMelhorMovimento');
      tabuleiro[melhorMovimento] = JOGADOR_X;
      atualizarTabuleiro();
    }

    if (jogoTerminou(tabuleiro)) {
      setTimeout(function() {
        exibirMensagemFimDoJogo();
        reiniciarJogo();
      }, 100);
    }
  }
}


    // Função para fazer um movimento no tabuleiro
    function makeMove(index) {
      if (!jogoTerminou(tabuleiro) && tabuleiro[index] === '') {
        tabuleiro[index] = JOGADOR_O;
        atualizarTabuleiro();

        if (!jogoTerminou(tabuleiro)) {
          const melhorMovimento = encontrarMelhorMovimento();
          tabuleiro[melhorMovimento] = JOGADOR_X;
          atualizarTabuleiro();
        }

        if (jogoTerminou(tabuleiro)) {
          setTimeout(function() {
            exibirMensagemFimDoJogo();
            reiniciarJogo();
          }, 100);
        }
      }
    }

    // Função para atualizar o tabuleiro no HTML
    function atualizarTabuleiro() {
      const cells = document.getElementsByClassName('cell');
      for (let i = 0; i < tabuleiro.length; i++) {
        cells[i].textContent = tabuleiro[i];
      }
    }

    // Função para exibir a mensagem de fim do jogo e atualizar a pontuação
    function exibirMensagemFimDoJogo() {
      const resultado = pontuacaoDoEstado(tabuleiro);

      if (resultado === 1) {
        pontuacao.vitorias++;
        document.getElementById('score').textContent = `Vitórias: ${pontuacao.vitorias} | Empates: ${pontuacao.empates} `;
        alert("Vitória!!");
      }  else{
        pontuacao.empates++;
        document.getElementById('score').textContent = `Vitórias: ${pontuacao.vitorias} | Empates: ${pontuacao.empates} `;
        alert("Empate!");
      }
    }

    // Função para reiniciar o jogo
    function reiniciarJogo() {
      for (let i = 0; i < tabuleiro.length; i++) {
        tabuleiro[i] = '';
      }
      atualizarTabuleiro();
    }

    // Adiciona um evento de reinício do jogo ao carregar a página
    window.onload = reiniciarJogo;
  </script>
</head>
<body>
  <h1>Jogo da Velha - Jogador x IA</h1>
  <h3>Algoritmo minimax com poda alfa-beta</h3>
  <div id="board">
    <div class="cell" onclick="makeMove(0)"></div>
    <div class="cell" onclick="makeMove(1)"></div>
    <div class="cell" onclick="makeMove(2)"></div>
    <div class="cell" onclick="makeMove(3)"></div>
    <div class="cell" onclick="makeMove(4)"></div>
    <div class="cell" onclick="makeMove(5)"></div>
    <div class="cell" onclick="makeMove(6)"></div>
    <div class="cell" onclick="makeMove(7)"></div>
    <div class="cell" onclick="makeMove(8)"></div>
  </div>

  <div id="score">Vitórias: 0 | Empates: 0</div>
  
</body>
</html>
